<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<ui:composition
    template="/WEB-INF/templates/login-layout.xhtml"
    xmlns:b="http://bootsfaces.net/ui"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <ui:param name="pageHeadline" value="${msg.evsHeadline}"/>
    <ui:define name="content">          
        <b:alert severity="danger" rendered="${votingPageBean.renderInvalidTokenMessage}">
            ${votingPageBean.errorMessage}
        </b:alert>

        <f:event listener="#{votingPageBean.init}" type="preRenderView" />

        <b:container rendered="#{votingPageBean.currentPollParticipant != null}">
            <h4>Welcome, #{votingPageBean.currentPollParticipant.email}</h4>
            <center><h5>You are voting on: <b>#{votingPageBean.currentPollParticipant.poll.title}</b></h5></center>
            <hr/>
            <form id="voting-form">
                <ui:repeat value="#{votingPageBean.pollQuestions}" var="question">
                    <div class="form-group">
                        <label for="#{question.uuid}">#{question.title}</label>
                        <ui:repeat value="#{question.answerChoices}" var="answer">
                            <div>
                                <input type="#{answer.inputType}" id="#{answer.uuid}" name="#{answer.inputName}" value="#{answer.shortName}" />
                                Â  <label for="#{answer.uuid}">#{answer.shortName}</label>
                            </div>

                        </ui:repeat>
                    </div>
                    <hr/>
                </ui:repeat>
                <button type="button">Cancel</button>
                <button type="submit">Submit</button>
            </form>
        </b:container>

        <f:metadata>
            <f:viewParam name="token" value="#{votingPageBean.token}"/>
        </f:metadata>
        <f:verbatim>
            <script type="text/javascript">
                var form = document.getElementById('voting-form');
                form.onsubmit = () => {
                    var data = new FormData(form);
                    const json = JSON.stringify(Object.fromEntries(data));
                    console.log(json);
                    return false;
                }
            </script>
        </f:verbatim>
    </ui:define>
</ui:composition>